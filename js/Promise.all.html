<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    //Promise.all() 方法接收一个promise的iterable类型（MDN）
    // 只返回一个promise实例
    // 当传入的参数promise全部成功时，最后的结果才会成功（成功的结果是所有的promise的成功的结果组成的数组），
    // 只要有一个promise失败，all返回的实例就是一个失败的promise（失败的结果是传入的参数中的第一个失败的promise的结果）

    let p1 = new Promise(resolve => {
      setTimeout(resolve, 200, 1)
    });
    let p2 = new Promise((resolve, reject) => reject(2));
    let p3 = 3;
    console.log(Promise.all([p1, p2, p3])); //all方法

    /*********手写Promise.all()方法***********/

    let myAll = function (parr) {
      let result = [], //最后成功的结果
        count = 0, //累加器，与len比较判断是否全部成功了
        len = parr.length;
      return new Promise((resolve, reject) => {
        for (let p of parr) { //依次测试传入的参数（转化为promise）是否是成功的
          Promise.resolve(p).then(res => {
              result[count] = res; //成功就加入到结果中
              count++; //累加器加一
              if (count == len) { //如果相等，说明都成功了，可以走成功resolve
                resolve(res);
              }
            },
            err => {
              //只要有一个失败了，直接走失败reject
              reject(err);
            })
        }
      })
    }
    console.log(myAll([p1, p2, p3]));
  </script>
</body>

</html>